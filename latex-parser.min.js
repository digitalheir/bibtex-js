!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["latex-parser"]=t():e["latex-parser"]=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,r){"use strict";function n(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{writable:!0,enumerable:!0,configurable:!0};if(!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==t){if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n)n={writable:!0,enumerable:!0,configurable:!0};else if(!(n instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===r)for(var o in t)void 0!==t[o]&&Object.defineProperty(e,o,Object.create(n,{value:{value:t[o]}}));else if(r instanceof Array)r.forEach(function(r){void 0!==t[r]&&Object.defineProperty(e,r,Object.create(n,{value:{value:t[r]}}))});else{if(!(r instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var i in r){var a=r[i];void 0!==t[a]&&Object.defineProperty(e,i,Object.create(n,{value:{value:t[a]}}))}}}}function o(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===t)return!0;if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n&&(n=!0),void 0===r){for(var o in t)if(e[o]!==t[o]&&(void 0!==t[o]||!n))return!1}else{if(r instanceof Array)return r.every(function(r){return e[r]===t[r]||void 0===t[r]&&n});if(!(r instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var i in r){var a=r[i];if(e[i]!==t[a]&&(void 0!==t[a]||!n))return!1}}return!0}function i(e){return"number"==typeof e}function a(e){return"string"==typeof e}function s(e){if(!e)throw new Error;return e}Object.defineProperty(t,"__esModule",{value:!0}),t.updateProperties=n,t.testProperties=o,t.isNumber=i,t.isString=a,t.mustNotBeUndefined=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return t.modes.hasOwnProperty(e)}function i(e){if(!o(e))throw new Error;return e}function a(e){return e&&e.hasOwnProperty("directive")&&e.hasOwnProperty("operand")}function s(e){if(!a(e))throw new Error;return e}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Lexeme={BINARY_OPERATOR:"BINARY_OPERATOR",BRACKETS:"BRACKETS",CELL_SEPARATOR:"CELL_SEPARATOR",CHAR:"CHAR",DIGIT:"DIGIT",DIRECTIVE:"DIRECTIVE",DISPLAY_EQUATION:"DISPLAY_EQUATION",FILE_PATH:"FILE_PATH",FLOATING_BOX:"FLOATING_BOX",HORIZONTAL_SKIP:"HORIZONTAL_SKIP",INLINE_EQUATION:"INLINE_EQUATION",LABEL:"LABEL",LENGTH:"LENGTH",LETTER:"LETTER",LINE_BREAK:"LINE_BREAK",LIST_ITEM:"LIST_ITEM",LIST:"LIST",NUMBER:"NUMBER",PARAGRAPH_SEPARATOR:"PARAGRAPH_SEPARATOR",PICTURE:"PICTURE",POST_OPERATOR:"POST_OPERATOR",PRE_OPERATOR:"PRE_OPERATOR",RAW:"RAW",SPACE:"SPACE",SUBSCRIPT:"SUBSCRIPT",SUPERSCRIPT:"SUPERSCRIPT",TABLE:"TABLE",TABULAR_PARAMETERS:"TABULAR_PARAMETERS",TAG:"TAG",UNKNOWN:"UNKNOWN",VERTICAL_SKIP:"VERTICAL_SKIP",WORD:"WORD",WRAPPER:"WRAPPER"},t.modes={LIST:"LIST",MATH:"MATH",PICTURE:"PICTURE",TABLE:"TABLE",TEXT:"TEXT",VERTICAL:"VERTICAL"},t.isMode=o,t.mustBeMode=i;var c=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),Object.defineProperty(this,"modeStates_",{value:{},enumerable:!1}),this.modeStates_[t.modes.LIST]=!1,this.modeStates_[t.modes.MATH]=!1,this.modeStates_[t.modes.PICTURE]=!1,this.modeStates_[t.modes.TABLE]=!1,this.modeStates_[t.modes.TEXT]=!0,this.modeStates_[t.modes.VERTICAL]=!1,void 0!==r&&this.update(r)}return u(e,[{key:"copy",value:function(){return new e(this.modeStates_)}},{key:"update",value:function(e){for(var r in e){var n=t.modes[i(r)];if(void 0===n)throw new TypeError('"modeStates['+r+"]\" isn't a Latex.Mode option");this.modeStates_[n]=e[r]}}},{key:"test",value:function(e){for(var r in e){var n=t.modes[i(r)];if(void 0===n)throw new TypeError('"modeStates['+r+"]\" isn't a Latex.Mode option");if(this.modeStates_[n]!==e[r])return!1}return!0}}]),e}();t.State=c,t.Directive={BEGIN:"BEGIN",END:"END"},t.GROUP="GROUP",t.isOperationProperties=a,t.mustBeOperationProperties=s;var l=function(){function e(r){if(n(this,e),void 0!==r){if(!(r instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var o=t.Directive[r.directive];if(!o)throw new TypeError('"initialProperties.directive" isn\'t an Latex.Directive option');switch(Object.defineProperty(this,"directive",{value:o,enumerable:!0}),r.operand){case t.GROUP:Object.defineProperty(this,"operand",{value:t.GROUP,enumerable:!0});break;default:var i=t.modes[r.operand];if(!i)throw new TypeError('"initialProperties.operand" isn\'t an Latex.Mode option');Object.defineProperty(this,"operand",{value:i,enumerable:!0})}}}return u(e,[{key:"equals",value:function(t){return t instanceof e&&(this.directive===t.directive&&this.operand===t.operand)}}]),e}();t.Operation=l},function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e.constructor===Array}function s(e){if(!a(e))throw new Error;return e}function u(e){return!0}function c(e){if(!u)throw new Error;return e}function l(e){return e instanceof T}function p(e){if(!l(e))throw new Error;return e}function f(e){return e instanceof w}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var v=r(0),y=r(1),b=function(){function e(){i(this,e),this.symbols_={},this.commands_={},this.environments_={}}return m(e,[{key:"loadPackage",value:function(e,t){if(void 0!==t.symbols){if(!(t.symbols instanceof Array))throw new TypeError('"stylePackage.symbols" isn\'t an Array');for(var r=t.symbols.length-1;r>=0;--r){var n=new O(t.symbols[r]);if(n.pattern){var o=n.pattern[0];this.symbols_.hasOwnProperty(o)||(this.symbols_[o]=[]);this.symbols_[o].push({symbol:n,packageName:e})}}}if(void 0!==t.commands){if(!(t.commands instanceof Array))throw new TypeError('"stylePackage.commands" isn\'t an Array');for(var i=t.commands.length-1;i>=0;--i){var a=new T(t.commands[i]);a.name&&(this.commands_[a.name]||(this.commands_[a.name]=[])).push({command:a,packageName:e})}}if(void 0!==t.environments){if(!(t.environments instanceof Array))throw new TypeError('"stylePackage.environments" isn\'t an Array');for(var s=t.environments.length-1;s>=0;--s){var u=new w(t.environments[s]),c=u.name;if(c){var l=this.environments_[c];void 0===l&&(l=[],this.environments_[c]=l),l.push({environment:u,packageName:e})}}}}},{key:"unloadPackage",value:function(e){for(var t in this.symbols_)if(this.symbols_.hasOwnProperty(t)){var r=s(this.symbols_[t]).filter(function(t){return t.packageName!==e});r.length?this.symbols_[t]=r:delete this.symbols_[t]}for(var n in this.commands_)if(this.commands_.hasOwnProperty(n)){var o=s(this.commands_[n]).filter(function(t){return t.packageName!==e});o.length?this.commands_[n]=o:delete this.commands_[n]}for(var i in this.environments_)if(this.environments_.hasOwnProperty(i)){var a=s(this.environments_[i]).filter(function(t){return t.packageName!==e});a.length?this.environments_[i]=a:delete this.environments_[i]}}},{key:"symbols",value:function(e,t){if(!(e instanceof y.State))throw new SyntaxError('"state" isn\'t a State instance');var r=this.symbols_[t];if(void 0===r)return[];for(var n=[],o=s(r).length-1;o>=0;--o){var i=r[o].symbol;e.test(i.modes)&&n.push(i)}return n}},{key:"commands",value:function(e,t){if(!(e instanceof y.State))throw new SyntaxError('"state" isn\'t a State instance');var r=this.commands_[t];if(!r)return[];for(var n=[],o=s(r).length-1;o>=0;--o){var i=r[o].command;e.test(i.modes)&&n.push(i)}return n}},{key:"environments",value:function(e,t){if(!(e instanceof y.State))throw new SyntaxError("state isn't State instance");var r=this.environments_[t];return r?s(r).filter(function(t){return e.test(t.modes)}):[]}}]),e}();t.default=b;var _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,e),void 0!==t){if(!(t instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');switch(t.lexeme){case void 0:case null:break;default:var r=y.Lexeme[t.lexeme];if(void 0===r)throw new TypeError('"initialProperties.lexeme" isn\'t a Lexeme option');Object.defineProperty(this,"lexeme",{value:r})}if(void 0!==t.modes){if(!(t.modes instanceof Object))throw new TypeError('"initialProperties.modes" isn\'t an Object instance');Object.defineProperty(this,"modes",{value:{}});for(var n in t.modes){var o=y.mustBeMode(n);if(void 0===o)throw new TypeError('"initialProperties.modes['+n+"]\" isn't a Mode option");Object.defineProperty(this.modes,o,{value:t.modes[n],enumerable:!0})}}}}return m(e,[{key:"equals",value:function(t){return t instanceof e&&(this.lexeme===t.lexeme&&v.testProperties(this.modes,t.modes,y.modes,!1))}}]),e}();t.Item=_,Object.defineProperties(_.prototype,{lexeme:{value:void 0,enumerable:!0},modes:{value:{},enumerable:!0}}),t.isParameterProperties=u,t.mustBeParameterProperties=c;var P=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return n(r);if(void 0!==e.operations){if(!(e.operations instanceof Array))throw new TypeError('"initialProperties.operations" isn\'t an Array instance');Object.defineProperty(r,"operations_",{value:e.operations.map(function(e){return new y.Operation(e)})})}return r}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&(this.operations_.length===e.operations_.length&&this.operations_.every(function(t,r){return t.equals(e.operations_[r])})))}},{key:"operations",get:function(){return this.operations_.slice()}}]),t}(_);t.Parameter=P,Object.defineProperties(P.prototype,{operations:{enumerable:!0}}),Object.defineProperties(P.prototype,{operations_:{value:[],enumerable:!1}});var O=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return n(r);if(void 0!==e.operations){if(!(e.operations instanceof Array))throw new TypeError('"initialProperties.operations" isn\'t an Array instance');Object.defineProperty(r,"operations_",{value:e.operations.map(function(e){return new y.Operation(y.mustBeOperationProperties(e))})})}if(void 0!==e.parameters){if(!(e.parameters instanceof Array))throw new TypeError('"initialProperties.parameters" isn\'t an Array instance');r.parameters_=e.parameters.map(function(e){return new P(c(e))})}if(void 0!==e.pattern){if("string"!=typeof e.pattern)throw new TypeError('"initialProperties.pattern" isn\'t a string');var o=e.pattern.match(/([ \t]+|#\d+|[^ \t#]+)/g);o&&(r.patternComponents_=o.map(function(e){switch(e[0]){case" ":case"\t":return;case"#":var t=Number(e.substring(1))-1;if(!r.parameters_[t])throw new TypeError('"initialProperties.pattern" contains the incorrect parameter number '+e.substring(1));return t;default:return e}}))}if(void 0!==e.html){if("string"!=typeof e.html)throw new TypeError('"initialProperties.html" isn\'t a string');Object.defineProperty(r,"html",{value:e.html,enumerable:!0})}return r}return o(t,e),m(t,[{key:"parameter",value:function(e){return this.parameters_[e]||void 0}},{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&(this.operations_.length===e.operations_.length&&(!!this.operations_.every(function(t,r){return t.equals(e.operations_[r])})&&(this.parameters_.length===e.parameters_.length&&(!!this.parameters_.every(function(t,r){return t.equals(e.parameters_[r])})&&this.html===e.html)))))}},{key:"operations",get:function(){return this.operations_.slice()}},{key:"parameters",get:function(){return this.parameters_.slice()}},{key:"patternComponents",get:function(){return v.mustNotBeUndefined(this.patternComponents_.slice())}},{key:"pattern",get:function(){return this.patternComponents_.map(function(e){if(v.isNumber(e))return"#"+(e+1);switch(void 0===e?"undefined":h(e)){case"string":return e;default:return" "}}).join("")}}]),t}(_);t.Symbol=O,Object.defineProperties(O.prototype,{operations:{enumerable:!0},parameters:{enumerable:!0},patternComponents:{enumerable:!0},pattern:{enumerable:!0}}),Object.defineProperties(O.prototype,{operations_:{value:[],enumerable:!1,writable:!0},parameters_:{value:[],enumerable:!1,writable:!0},patternComponents_:{value:[],enumerable:!1,writable:!0},html:{value:"",enumerable:!0,writable:!0}});var T=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return n(r);if(void 0!==e.name){if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');Object.defineProperty(r,"name",{value:e.name})}return r}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&this.name===e.name)}}]),t}(O);t.Command=T,Object.defineProperties(T.prototype,{name:{value:"",enumerable:!0}}),t.isCommand=l,t.mustBeCommand=p;var w=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return n(r);if(void 0!==e.name){if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');Object.defineProperty(r,"name",{value:e.name})}return r}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&this.name===e.name)}}]),t}(_);t.Environment=w,Object.defineProperties(w.prototype,{name:{value:"",enumerable:!0}}),t.isEnvironment=f},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return e&&e instanceof T}function s(e){if(!u(e))throw new Error;return e}function u(e){return e instanceof w}function c(e){if(a(e.beginCommandToken))return e.beginCommandToken}function l(e){if(a(e.endCommandToken))return e.endCommandToken}function p(e){if(e.environment&&d.isEnvironment(e.environment))return e.environment}var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)};Object.defineProperty(t,"__esModule",{value:!0});var d=r(2),m=r(4),v=r(1),y=r(0),b=function(e){function t(e,r){if(n(this,t),!(e instanceof _))throw new TypeError('"rootToken" isn\'t a Token instance');return o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return i(t,e),t}(m.SyntaxTree);t.default=b;var _=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n(this,t),void 0===e)var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));else{if(!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var i=Object.create(e);i.parentNode=e.parentToken,i.childNodes=e.childTokens;var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i))}return o(r)}return i(t,e),f(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0):"Token{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}"}}]),t}(m.Node);t.Token=_,Object.defineProperties(_.prototype,{lexeme:{value:void 0,enumerable:!0},parentNodeClass_:{value:_}});var P=function(e){function t(e){if(n(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(e.symbol){if(!(e.symbol instanceof d.Symbol))throw new TypeError('"initialProperties.symbol" isn\'t a Symbol instance');Object.defineProperty(r,"symbol",{value:e.symbol,enumerable:!0})}else{if("string"!=typeof e.pattern)throw new TypeError('"initialProperties.pattern" isn\'t a string');Object.defineProperty(r,"pattern",{value:e.pattern})}return r}return i(t,e),f(t,[{key:"toString",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="",r=0,n=this.pattern,o=n.length,i=0;i<o;++i){var a=n[i];if("#"===a){++i;var s=this.childNode(r++);t+=s?s.toString(!0):"??"}else t+=a}return e?t:"SymbolToken"+(this.symbol?"":"[?]")+"{"+t+"}"}},{key:"lexeme",get:function(){return this.symbol?this.symbol.lexeme:void 0}},{key:"pattern",get:function(){return y.mustNotBeUndefined(this.symbol).pattern}}]),t}(_);t.SymbolToken=P,Object.defineProperties(P.prototype,{symbol:{value:void 0,enumerable:!0}}),Object.defineProperties(P.prototype,{pattern:{enumerable:!0}});var O=function(e){function t(e){if(n(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.hasBrackets||Object.defineProperty(r,"hasBrackets",{value:!1,enumerable:!0}),e.hasSpacePrefix&&Object.defineProperty(r,"hasSpacePrefix",{value:!0,enumerable:!0}),r}return i(t,e),f(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.hasSpacePrefix?" ":"";return r+=this.hasBrackets?"{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}":h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0),e?r:"ParameterToken{"+r+"}"}},{key:"lexeme",get:function(){if(this.parameter&&this.parameter.lexeme)return this.parameter.lexeme}},{key:"parameter",get:function(){var e=this.parentNode,t=y.mustNotBeUndefined(e.symbol),r=e.childIndex(this);if(void 0!==e&&void 0!==r&&r>=0)return t.parameter(r)}}]),t}(_);t.ParameterToken=O,Object.defineProperties(O.prototype,{hasBrackets:{value:!0,enumerable:!0},hasSpacePrefix:{value:!1,enumerable:!0},parentNodeClass_:{value:P}}),Object.defineProperties(O.prototype,{parameter:{enumerable:!0}});var T=function(e){function t(e){if(n(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=Object.create(e);if(e.command){if(!(e.command instanceof d.Command))throw new TypeError('"initialProperties.command" isn\'t a LatexStyle.Command instance');r.symbol=e.command;var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r))}else{if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');r.pattern="";var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));Object.defineProperty(i,"name",{value:e.name})}return o(i)}return i(t,e),f(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r="\\"+this.name+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0);return e?r:"CommandToken"+(this.command?"":"[?]")+"{"+r+"}"}},{key:"command",get:function(){return d.mustBeCommand(this.symbol)}},{key:"name",get:function(){return this.command.name}}]),t}(P);t.CommandToken=T,Object.defineProperties(T.prototype,{command:{enumerable:!0},name:{enumerable:!0}}),t.isCommandToken=a;var w=function(e){function t(e){if(n(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!(e.environment instanceof d.Environment))throw new TypeError('"initialProperties.environment" isn\'t a LatexStyle.Environment instance');return Object.defineProperty(r,"environment",{value:e.environment,enumerable:!0}),r}return i(t,e),f(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.beginCommandToken,r=this.endCommandToken,n=this.bodyToken,o="\\begin{"+this.environment.name+"}";return o+=t?P.prototype.toString.call(t,!0):"??",o+=n?n.toString(!0):"??",o+="\\end{"+this.environment.name+"}",o+=r?P.prototype.toString.call(r,!0):"??",e?o:"EnvironmentToken{"+o+"}"}},{key:"lexeme",get:function(){return this.environment.lexeme}},{key:"beginCommandToken",get:function(){var e=this.childNode(0);return e instanceof T?e:void 0}},{key:"endCommandToken",get:function(){var e=this.childNode(2);return e instanceof T?e:void 0}},{key:"bodyToken",get:function(){var e=this.childNode(1);return e instanceof g?e:void 0}}]),t}(_);t.EnvironmentToken=w,Object.defineProperties(w.prototype,{beginToken:{enumerable:!0},endToken:{enumerable:!0}}),t.mustBeEnvironmentToken=s,t.isEnvironmentToken=u;var g=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),f(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0):"EnvironmentBodyToken{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}"}},{key:"environment",get:function(){return this.parentNode&&p(this.parentNode)}},{key:"environmentToken",get:function(){return this.parentNode&&s(this.parentNode)}},{key:"beginCommandToken",get:function(){return this.parentNode&&c(this.parentNode)}},{key:"endCommandToken",get:function(){return this.parentNode&&l(this.parentNode)}}]),t}(_);t.EnvironmentBodyToken=g,Object.defineProperties(g.prototype,{parentNodeClass_:{value:w}});var k=function(e){function t(e){if(n(this,t),void 0===e){var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o(r)}if(!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(e.lineBreakCount){if(!isFinite(e.lineBreakCount)||e.lineBreakCount<0)throw new TypeError('"initialProperties.lineBreakCount" isn\'t a non-negative number');Object.defineProperty(r,"lineBreakCount",{value:e.lineBreakCount,enumerable:!0})}return o(r)}return i(t,e),f(t,[{key:"toString",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])switch(this.lineBreakCount){case 0:return" ";case 1:return"\n";default:return"\n\n"}else switch(this.lineBreakCount){case 0:return"SpaceToken{ }";case 1:return"SpaceToken{\n}";default:return"SpaceToken{\n\n}"}}},{key:"lexeme",get:function(){return this.lineBreakCount<=1?"SPACE":"PARAGRAPH_SEPARATOR"}}]),t}(_);t.SpaceToken=k,Object.defineProperties(k.prototype,{lineBreakCount:{value:0,enumerable:!0}});var E=function(e){function t(e){if(n(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!v.Lexeme[e.lexeme])throw new TypeError('"initialProperties.lexeme" isn\'t known');if(Object.defineProperty(r,"lexeme",{value:e.lexeme,enumerable:!0}),"string"!=typeof e.source)throw new TypeError('"initialProperties.sources" isn\'t a string');return Object.defineProperty(r,"source",{value:e.source,enumerable:!0}),r}return i(t,e),f(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.source:"SourceToken["+this.lexeme+"]{"+this.source+"}"}}]),t}(_);t.SourceToken=E},function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=function e(t,r){if(o(this,e),!(t instanceof u))throw new TypeError('"rootNode" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"rootNode" has a parent node');if(t.tree)throw new TypeError('"rootNode" is a tree root');if("string"!=typeof r)throw new TypeError('"sources" isn\'t a string');Object.defineProperty(this,"rootNode",{value:t,enumerable:!0}),Object.defineProperty(this,"source",{value:r,enumerable:!0}),Object.defineProperty(t,"tree",{value:this,enumerable:!0})};t.SyntaxTree=s;var u=function(){function e(t){if(o(this,e),void 0!==t){if(!(t instanceof Object))throw new TypeError("initialProperties isn't an Object instance");if(void 0!==t.childNodes){if(!(t.childNodes instanceof Array))throw new TypeError("initialProperties.childNodes isn't an Array instance");t.childNodes.forEach(this.insertChildSubtree,this)}var r=t.parentNode;if(void 0!==r){if(!r)throw new TypeError("initialProperties.parentNode isn't a SyntaxTree.Node instance");r.insertChildSubtree(this)}}}return i(e,[{key:"childNode",value:function(t){if(a.isNumber(t))return this.childNodes_[t]||void 0;if(t instanceof e)return t.parentNode===this?t:void 0;throw new TypeError('"node" is neither a number nor a SyntaxTree.Node instance')}},{key:"childIndex",value:function(t){if(a.isNumber(t))return this.childNodes_[t]?t:void 0;if(t instanceof e)return t.parentNode===this?this.childNodes_.indexOf(t):void 0;throw new TypeError('"node" is neither a number nor a SyntaxTree.Node instance')}},{key:"insertChildNode",value:function(t,r,n){if(!(t instanceof e))throw new TypeError('"node" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"node" has a parent');if(t.tree)throw new TypeError('"node" is a tree root');if(t.childNodes_.length)throw new TypeError('"node" has child nodes');this.hasOwnProperty("childNodes_")||Object.defineProperty(this,"childNodes_",{value:[],configurable:!0}),void 0===r&&(r=this.childNodes_.length),void 0===n&&(n=0);var o=this.childNodes_.splice(r,n,t);Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize+1,enumerable:!0,configurable:!0});for(var i=this.parentNode;i;i=i.parentNode)Object.defineProperty(i,"subtreeSize",{value:i.subtreeSize+1});if(Object.defineProperty(t,"parentNode",{value:this,enumerable:!0,configurable:!0}),o.length){Object.defineProperty(t,"childNodes_",{value:o,configurable:!0});var a=1;o.forEach(function(e){a+=e.subtreeSize}),Object.defineProperty(t,"subtreeSize",{value:a,enumerable:!0,configurable:!0})}return t}},{key:"insertChildSubtree",value:function(t,r){if(!(t instanceof e))throw new TypeError('"node" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"node" has a parent');if(t.tree)throw new TypeError('"node" is a tree root');this.hasOwnProperty("childNodes_")||Object.defineProperty(this,"childNodes_",{value:[],configurable:!0}),void 0===r&&(r=this.childNodes_.length),this.childNodes_.splice(r,0,t);var n=t.subtreeSize;Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize+n,enumerable:!0,configurable:!0});for(var o=this.parentNode;o;o=o.parentNode)Object.defineProperty(o,"subtreeSize",{value:o.subtreeSize+n});Object.defineProperty(t,"parentNode",{value:this,enumerable:!0,configurable:!0})}},{key:"removeChildNode",value:function(e){var t,r=this.childIndex(e);if(void 0!==r){var o=this.childNodes_[r];(t=this.childNodes_).splice.apply(t,[r,1].concat(n(o.childNodes_))),this.childNodes_.length?Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize-1}):(delete this.childNodes_,delete this.subtreeSize);for(var i=this.parentNode;i;i=i.parentNode)Object.defineProperty(i,"subtreeSize",{value:i.subtreeSize-1});return delete o.parentNode,delete o.childNodes_,delete o.subtreeSize,o}}},{key:"removeChildSubtree",value:function(e){var t=this.childIndex(e);if(void 0!==t){e=this.childNodes_.splice(t,1)[0];var r=e.subtreeSize;this.childNodes_.length?Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize-r}):(delete this.childNodes_,delete this.subtreeSize);for(var n=this.parentNode;n;n=n.parentNode)Object.defineProperty(n,"subtreeSize",{value:n.subtreeSize-r});return delete e.parentNode,e}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="";return this.childNodes_.forEach(function(e){t+=e.toString(!0)}),e?t:"SourceTree.Node{"+t+"}"}},{key:"childNodes",get:function(){return this.childNodes_.slice()}}]),e}();t.Node=u,Object.defineProperties(u.prototype,{childNodes:{enumerable:!0}}),Object.defineProperties(u.prototype,{tree:{value:void 0,enumerable:!0},parentNode:{value:void 0,enumerable:!0},subtreeSize:{value:1,enumerable:!0},childNodes_:{value:[],enumerable:!1},parentNodeClass_:{value:u,enumerable:!1}})},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.source.substring(e.position).match(/^%([^\n]*)(\n[ \t]*)?/);return!!t&&(e.comments.push(t[1]),e.position+=t[0].length,t[2]?(++e.lineNumber,e.charNumber=t[2].length-1):e.charNumber+=t[0].length,!0)}function i(e,t){e.currentToken&&e.currentToken.insertChildSubtree(t)}function a(e){for(var t=!1,r=0;e.position<e.source.length;)if(!o(e)){switch(e.source[e.position]){case" ":case"\t":t=!0,++e.position,++e.charNumber;continue;case"\n":t=!0,++r,++e.position,++e.lineNumber,e.charNumber=0;continue}break}return t?new c.SpaceToken({lineBreakCount:r}):void 0}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=r(2),c=r(3),l=r(1),p=r(0),f=function(){function e(t){if(n(this,e),!(t instanceof u.default))throw new TypeError('"latexStyle" isn\'t a LatexStyle instance');Object.defineProperty(this,"latexStyle",{value:t,enumerable:!0})}return s(e,[{key:"parse",value:function(e,t){if("string"!=typeof e)throw new TypeError('"sources" isn\'t a string');var r=void 0;if(void 0===t)r=new h(e);else{if(!(t instanceof h))throw new TypeError('"context" isn\'t a LatexParser.Context instance');r=t,r.source+=e}for(var n=[];;){var o=this.parseToken_(r);if(void 0===o)break;n.push(o)}return n}},{key:"parseToken_",value:function(e){var t=a(e);if(!t){if(e.position>=e.source.length)return;var r=e.copy();if(!((t=this.parseEnvironmentToken_(e))||(r.copy(e),(t=this.parseCommandToken_(e))||(r.copy(e),t=this.parseSymbolsToken_(e)))))return}return i(e,t),t}},{key:"parseParameterToken_",value:function(e,t,r){var n=e.currentToken;if(e.updateState(t.operations),void 0===r){var o=void 0!==a(e);if("{"===e.source[e.position]){if(e.currentToken=new c.ParameterToken({hasBrackets:!0,hasSpacePrefix:o}),++e.position,++e.charNumber,!this.parseUntilLabel_(e,"}",t.lexeme))return;++e.position,++e.charNumber}else if(e.currentToken=new c.ParameterToken({hasBrackets:!1,hasSpacePrefix:o}),void 0===this.parseToken_(e))return}else if(e.currentToken=new c.ParameterToken({hasBrackets:!1,hasSpacePrefix:!1}),!this.parseUntilLabel_(e,r,t.lexeme))return;var s=e.currentToken;return e.currentToken=n,i(e,s),s}},{key:"parseEnvironmentToken_",value:function(e){if(e.source.startsWith("\\begin",e.position)){e.position+=6,a(e);var t=e.source.substring(e.position).match(/^{([\w@]+\*?)}/);if(t){var r=t[1];e.position+=t[0].length,e.charNumber+=t[0].length;var n=e.currentToken,o=this.latexStyle.environments(e.currentState,r)[0],s=e.currentToken=o?new c.EnvironmentToken({environment:o.environment}):new c.EnvironmentToken({name:r}),u=this.latexStyle.commands(e.currentState,r),l=this.parsePatterns_(e,u);void 0===l&&(l=new c.CommandToken({name:r})),i(e,l);var p=e.currentToken=new c.EnvironmentBodyToken,f=this.parseUntilLabel_(e,"\\end{"+r+"}");e.currentToken=s,i(e,p);var h=void 0;return f&&(e.position+=r.length+6,e.charNumber+=r.length+6,h=this.parsePatterns_(e,this.latexStyle.commands(e.currentState,"end"+r))),void 0===h&&(h=new c.CommandToken({name:"end"+r})),i(e,h),e.currentToken=n,s}}}},{key:"parseCommandToken_",value:function(e){var t=e.source.substring(e.position).match(/^\\([\w@]+\*?)/);if(t){e.position+=t[0].length,e.charNumber+=t[0].length;var r=this.parsePatterns_(e,this.latexStyle.commands(e.currentState,t[1]));return void 0===r&&(r=new c.CommandToken({name:t[1]})),r}}},{key:"parseSymbolsToken_",value:function(e){var t=e.source[e.position],r=this.parsePatterns_(e,this.latexStyle.symbols(e.currentState,t));return void 0===r&&(++e.position,++e.charNumber,r=new c.SymbolToken({pattern:t})),r}},{key:"parsePatterns_",value:function(e,t){var r=this,n=e.copy(),o=void 0;return t.some(function(t){return!!(o=r.parsePattern_(e,t))||(n.copy(e),!1)}),o}},{key:"parsePattern_",value:function(e,t){var r=e.currentToken;e.currentToken=t instanceof u.Command?new c.CommandToken({command:t}):new c.SymbolToken({symbol:t});for(var n=t.patternComponents,i=n.length,s=0;s<i;++s){var l=n[s];if(p.isNumber(l)){var f=t.parameter(l),h=n[s+1];if("string"==typeof h){if(this.parseParameterToken_(e,p.mustNotBeUndefined(f),h)){if(!e.source.startsWith(h,e.position))return;e.position+=h.length,e.charNumber+=h.length,++s;continue}}else if(this.parseParameterToken_(e,p.mustNotBeUndefined(f)))continue}else if(p.isString(l)){for(;o(e););if(e.source.startsWith(l,e.position)){e.position+=l.length,e.charNumber+=l.length;continue}}else if(a(e))continue;break}if(!(s<i)){var d=e.currentToken;return e.currentToken=r,e.updateState(t.operations),d}}},{key:"parseUntilLabel_",value:function(e,t,r){for(;!e.source.startsWith(t,e.position);){if(e.position>=e.source.length)return!1;this.parseToken_(e)}return!0}}]),e}();t.LatexParser=f;var h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n(this,e),this.source=t||"",this.position=0,this.lineNumber=0,this.charNumber=0,this.currentToken=void 0,this.currentState=new l.State,this.stateStack=[],this.comments=[]}return s(e,[{key:"copy",value:function(t){var r=t||new e;return r.source=this.source,r.position=this.position,r.lineNumber=this.lineNumber,r.charNumber=this.charNumber,r.currentToken=this.currentToken,r.currentState=this.currentState.copy(),r.stateStack=this.stateStack.slice(),r.comments=this.comments.slice(),r}},{key:"updateState",value:function(e){var t=this;if(!(e instanceof Array))throw new TypeError('"operations" isn\'t an Array instance');var r={};e.forEach(function(e){switch(e.directive){case l.Directive.BEGIN:switch(e.operand){case l.GROUP:t.currentState.update(r),r={},t.stateStack.push(t.currentState.copy());break;default:r[e.operand]=!0}break;case l.Directive.END:switch(e.operand){case l.GROUP:if(r={},t.stateStack.length<1)throw new Error("state stack is empty");t.currentState=p.mustNotBeUndefined(t.stateStack.pop());break;default:r[e.operand]=!1}}}),this.currentState.update(r)}}]),e}();t.Context=h,t.default=f},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(0)),n(r(1)),n(r(2)),n(r(4)),n(r(3)),n(r(5))}])});
//# sourceMappingURL=latex-parser.min.js.map